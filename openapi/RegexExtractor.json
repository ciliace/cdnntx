{
  "swagger": "2.0",
  "info": { "version": "1.0.0", "title": "Regex Extractor (JSON only)" },
  "host": "nac-byc.azurewebsites.net",
  "basePath": "/",
  "schemes": ["https"],
  "consumes": ["application/json"],
  "produces": ["application/json"],
  "paths": {
    "/api/regex-extractor-json": {
      "post": {
        "summary": "Extract using application/json (Base64 in 'payloadBase64')",
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": { "$ref": "#/definitions/JsonRequest" }
          }
        ],
        "responses": {
          "200": { "description": "OK", "schema": { "$ref": "#/definitions/ExtractionResponse" } },
          "400": { "description": "Bad Request", "schema": { "$ref": "#/definitions/ErrorResponse" } },
          "415": { "description": "Unsupported Media Type" },
          "500": { "description": "Server Error", "schema": { "$ref": "#/definitions/ErrorResponse" } }
        }
      }
    }
  },
  "definitions": {
    "JsonRequest": {
      "type": "object",
      "required": ["mode"],
      "properties": {
        "mode":      { "type": "string", "enum": ["table","custom"], "default": "table" },
        "pattern":   { "type": "string", "description": "Used when mode=custom" },
        "flags":     { "type": "string", "default": "gmu" },
        "text":      { "type": "string", "description": "Optional raw text (mutually exclusive with payloadBase64)" },
        "payloadBase64": {
          "type": "string",
          "description": "Raw Base64 (not URL-encoded). Do NOT wrap in <file>."
        },
        "filename":  { "type": "string" }
      }
    },
    "ExtractionResponse": {
      "type": "object",
      "required": ["line_count","order_lines","meta"],
      "properties": {
        "filename":  { "type": "string" },
        "line_count":{ "type": "integer", "format": "int32" },
        "order_lines": { "type": "array", "items": { "$ref": "#/definitions/OrderLine" } },
        "meta": {
          "type": "object",
          "required": ["mode","used_flags","used_pattern"],
          "properties": {
            "mode": { "type": "string" },
            "used_flags": { "type": "string" },
            "used_pattern": { "type": "string" }
          }
        }
      }
    },
    "OrderLine": {
      "type": "object",
      "properties": {
        "Order": { "type": "string" }, "Pos": { "type": "string" }, "Type": { "type": "string" },
        "Article": { "type": "string" }, "Lot": { "type": "string" }, "Designation": { "type": "string" },
        "UQ1": { "type": "string" }, "QteNec": { "type": "string" }, "QtePrelev": { "type": "string" },
        "Origine": { "type": "string" }, "DateBes": { "type": "string" }, "Activite": { "type": "string" },
        "Poste": { "type": "string" }, "Div": { "type": "string" }, "ES": { "type": "string" },
        "Statut": { "type": "string" }, "DescrPosteTrav": { "type": "string" }, "DesOp": { "type": "string" },
        "Empl": { "type": "string" }, "GAc": { "type": "string" }, "GrpeMar": { "type": "string" },
        "Nomenclat": { "type": "string" }, "PosTr": { "type": "string" }, "NoRes": { "type": "string" },
        "TP": { "type": "string" }, "Res_DA": { "type": "string" }, "TyBes": { "type": "string" },
        "TyMag": { "type": "string" }, "CategNcl": { "type": "string" }, "UQ2": { "type": "string" }
      }
    },
    "ErrorResponse": {
      "type": "object",
      "required": ["error"],
      "properties": { "error": { "type": "string" } }
    }
  }
}
